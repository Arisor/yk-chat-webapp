(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-af718732"],{"09e3":function(t,e,s){"use strict";var i=s("a2f9"),a=s.n(i);a.a},"159b":function(t,e,s){var i=s("da84"),a=s("fdbc"),r=s("17c2"),n=s("9112");for(var o in a){var c=i[o],u=c&&c.prototype;if(u&&u.forEach!==r)try{n(u,"forEach",r)}catch(f){u.forEach=r}}},"17c2":function(t,e,s){"use strict";var i=s("b727").forEach,a=s("a640"),r=s("ae40"),n=a("forEach"),o=r("forEach");t.exports=n&&o?[].forEach:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}},4160:function(t,e,s){"use strict";var i=s("23e7"),a=s("17c2");i({target:"Array",proto:!0,forced:[].forEach!=a},{forEach:a})},"72cc":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"private-chat-wrapper"},[s("div",{ref:"chatList",staticClass:"chat-content-wrapper"},[s("van-list",{attrs:{finished:t.finished,direction:"up"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.privateDetail,(function(e,i){return s("div",{key:i},[(t.$store.getters.userIdGetter,e.from_user,s("ChatItem",{attrs:{href:e.from_user,img:e.avator,me:t.$store.getters.userIdGetter===e.from_user,msg:e.message,name:e.name,time:t._f("calendar")(e.time)}}))],1)})),0)],1),s("div",{staticClass:"input-msg"},[s("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.inputMsg,expression:"inputMsg",modifiers:{trim:!0}}],ref:"message",attrs:{rows:"1",placeholder:"请输入"},domProps:{value:t.inputMsg},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.handleSendMsg(e))},input:function(e){e.target.composing||(t.inputMsg=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),s("div",{staticClass:"btn",on:{click:t.handleSendMsg}},[t._v("发送")])])])},a=[],r=(s("4160"),s("b0c0"),s("159b"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat-item"},[s("div",{class:t.me?"mychat":"otherchat"},[s("van-image",{staticClass:"img",attrs:{"lazy-load":"",round:"",width:"1.2rem",height:"1.2rem",src:t.img}}),s("div",{staticClass:"ci"},[s("div",{staticClass:"nt"},[t.time?s("span",[t._v(t._s(t.time))]):t._e(),t.name?s("span",[t._v(t._s(t.name))]):t._e()]),s("div",{staticClass:"msg"},[t._v(t._s(t.msg))])])],1)])}),n=[],o={name:"chat-item",props:["me","name","img","msg","time","href"],components:{},data:function(){return{}},computed:{},watch:{},methods:{lookInfo:function(){this.$router.push("/user_info/".concat(this.href))}}},c=o,u=(s("09e3"),s("2877")),f=Object(u["a"])(c,r,n,!1,null,"0886acb1",null),m=f.exports,h=s("365c"),l={components:{ChatItem:m},data:function(){return{loading:!1,finished:!1,privateDetail:[],inputMsg:""}},methods:{onLoad:function(){var t=this;this.loading=!0,Object(h["f"])({to_user:this.$route.params.id}).then((function(e){e.data.privateDetail.forEach((function(e){t.privateDetail.push({from_user:e.from_user,avator:s("f3f2"),message:e.message,name:e.name,time:e.time})})),t.$refs.message.focus(),t.refershScroll(),t.loading=!1,t.finished=!0})).catch((function(){t.loading=!1,t.finished=!0}))},handleSendMsg:function(){this.$refs.message.focus(),""!==this.inputMsg&&(this.sendMsgBySocket(),this.saveMsgByDB())},sendMsgBySocket:function(){var t={from_user:this.$store.getters.userIdGetter,to_user:this.$route.params.id,name:this.$route.params.name,avator:"",message:this.inputMsg,type:"private",status:"1",time:Date.now()};this.$socket.emit("sendPrivateMsg",t)},saveMsgByDB:function(){var t=this,e=Date.now(),i={from_user:this.$store.getters.userIdGetter,to_user:this.$route.params.id,name:this.$route.params.name,avator:"",message:this.inputMsg,type:"private",status:"1",time:e};Object(h["m"])(i).then((function(i){t.privateDetail.push({from_user:t.$store.getters.userIdGetter,avator:s("f3f2"),message:t.inputMsg,name:t.$route.params.name,time:e}),t.inputMsg="",t.refershScroll()}))},refershScroll:function(){var t=this;this.$nextTick((function(){t.$refs.chatList.scrollTop=t.$refs.chatList.scrollHeight}))},setIsRead:function(){var t=this;Object(h["n"])({from_user:this.$route.params.id}).then((function(){t.getUnReadCount()}))},getUnReadCount:function(){var t=this;Object(h["g"])().then((function(e){t.$store.dispatch("msgCountAction",e.data.count)}))}},created:function(){this.$store.dispatch("titleAction",this.$route.params.name),this.setIsRead()},sockets:{getPrivateMsg:function(t){this.privateDetail.push({from_user:t.from_user,avator:s("f3f2"),message:t.message,name:t.name,time:t.time}),this.refershScroll(),this.setIsRead()}}},d=l,p=(s("8256"),Object(u["a"])(d,i,a,!1,null,"7c551cca",null));e["default"]=p.exports},8256:function(t,e,s){"use strict";var i=s("e3ce"),a=s.n(i);a.a},a2f9:function(t,e,s){},a640:function(t,e,s){"use strict";var i=s("d039");t.exports=function(t,e){var s=[][t];return!!s&&i((function(){s.call(null,e||function(){throw 1},1)}))}},e3ce:function(t,e,s){},f3f2:function(t,e,s){t.exports=s.p+"img/friend.0093278a.png"},fdbc:function(t,e){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}}}]);
//# sourceMappingURL=chunk-af718732.c919a09c.js.map